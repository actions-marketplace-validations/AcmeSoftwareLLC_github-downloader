name: Test Workflow

on:
  workflow_call:
  push:
    branches:
      - main

jobs:
  download-success:
    runs-on: ubuntu-latest
    name: Successful Download Test
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download existing files
        id: download
        uses: ./
        with:
          owner: creativetimofficial
          repo: public-assets
          token: ${{ secrets.GITHUB_TOKEN }}
          mappings: |
            {
              "argon-pro-flutter/chat-screen.jpg": "app/screen.jpg",
              "argon-pro-flutter/beauty-screen.jpg": "next/beauty.jpg"
            }
          output-directory: downloads

      - name: Print downloaded files
        run: |
          echo "✅ Downloaded files:"
          echo "${{ steps.download.outputs.files }}"

  download-failure:
    runs-on: ubuntu-latest
    name: Failure Download Test
    continue-on-error: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download non-existent file
        id: download_step
        uses: ./
        with:
          owner: creativetimofficial
          repo: public-assets
          token: ${{ secrets.GITHUB_TOKEN }}
          mappings: |
            {
              "argon-pro-flutter/this-file-does-not-exist.jpg": "bad/output.jpg"
            }
          output-directory: downloads

      - name: Verify failure
        if: steps.download_step.outcome == 'success'
        run: |
          echo "❌ Expected this step to fail but it succeeded"
          exit 1
