{"version":3,"file":"index.mjs","names":[],"sources":["../src/utils.ts","../src/main.ts","../src/index.ts"],"sourcesContent":["import type { Dirent } from \"node:fs\";\nimport { readdir, stat } from \"node:fs/promises\";\nimport { join } from \"node:path\";\n\nexport type FileMapping = [string, string];\n\nimport { createWriteStream } from \"node:fs\";\nimport { pipeline } from \"node:stream/promises\";\n\nasync function download(\n\turl: string,\n\theaders: Headers,\n\toutputPath: string,\n): Promise<void> {\n\tconst res = await fetch(url, { method: \"GET\", headers: headers });\n\tif (!res.ok || !res.body) {\n\t\tthrow new Error(`Failed to download ${url} (status ${res.status})`);\n\t}\n\tconst fileStream = createWriteStream(outputPath);\n\tawait pipeline(res.body, fileStream);\n}\n\nasync function getFiles(directory: string): Promise<string[]> {\n\tconst dirents: Dirent[] = (await readdir(directory, {\n\t\trecursive: true,\n\t\twithFileTypes: true,\n\t})) as unknown as Dirent[];\n\treturn dirents\n\t\t.filter((dirent) => dirent.isFile())\n\t\t.map((dirent) => join(directory, dirent.name));\n}\n\nasync function parseMappings(mappings: string[]): Promise<FileMapping[]> {\n\tconst mappingStr = mappings.join(\"\");\n\treturn Object.entries(JSON.parse(mappingStr));\n}\n\nasync function logFileDownload(\n\tinput: string,\n\toutputPath: string,\n): Promise<void> {\n\tconst { size } = await stat(outputPath);\n\tconst sizeStr =\n\t\tsize < 1024 ? `${size} bytes` : `${(size / 1024).toFixed(2)} KB`;\n\tconsole.log(\n\t\t`\\nðŸ“¥ File Downloaded!\\n` +\n\t\t\t`   â€¢ Source:      \\x1b[36m${input}\\x1b[0m\\n` +\n\t\t\t`   â€¢ Saved as:    \\x1b[32m${outputPath}\\x1b[0m\\n` +\n\t\t\t`   â€¢ Size:        \\x1b[33m${sizeStr}\\x1b[0m\\n` +\n\t\t\t`----------------------------------------`,\n\t);\n}\n\nexport { download, getFiles, logFileDownload, parseMappings };\n","import { mkdir } from \"node:fs/promises\";\nimport { dirname, join } from \"node:path\";\nimport { getInput, getMultilineInput, setFailed, summary } from \"@actions/core\";\nimport {\n\tdownload,\n\ttype FileMapping,\n\tgetFiles,\n\tlogFileDownload,\n\tparseMappings,\n} from \"./utils.js\";\n\nexport async function run(): Promise<void> {\n\ttry {\n\t\tconst repo = getInput(\"repo\", { required: true });\n\t\tconst ref = getInput(\"ref\") || \"main\";\n\t\tconst pat = getInput(\"git-pat\");\n\t\tconst outputDir = getInput(\"output-directory\");\n\n\t\tconst headers = new Headers();\n\t\tif (pat) {\n\t\t\theaders.append(\"Authorization\", `token ${pat}`);\n\t\t}\n\n\t\tconst mappings = await parseMappings(getMultilineInput(\"mappings\"));\n\t\tconst props = { repo, ref, headers, outputDir };\n\n\t\tconst downloadedFiles = await downloadMappedFiles(mappings, props);\n\t\tconst allFiles = await getFiles(outputDir);\n\n\t\tawait writeSummary({\n\t\t\tdownloadedFiles: mappings.map((mapping, index) => [\n\t\t\t\tmapping[0],\n\t\t\t\tdownloadedFiles[index],\n\t\t\t]),\n\t\t\trepo,\n\t\t\tref,\n\t\t\tallFiles,\n\t\t});\n\t} catch (error) {\n\t\tsetFailed(error instanceof Error ? error.message : String(error));\n\t}\n}\n\ninterface DownloadProps {\n\trepo: string;\n\tref: string;\n\theaders: Headers;\n\toutputDir: string;\n}\n\nasync function downloadMappedFiles(\n\tmappings: FileMapping[],\n\t{ repo, ref, headers, outputDir }: DownloadProps,\n): Promise<string[]> {\n\tasync function downloadSingleFile(mapping: FileMapping): Promise<string> {\n\t\tconst [source, destination] = mapping;\n\t\tconst outputPath = outputDir ? join(outputDir, destination) : destination;\n\t\tconst url = `https://raw.githubusercontent.com/${repo}/${ref}/${source}`;\n\n\t\tawait mkdir(dirname(outputPath), { recursive: true });\n\t\tawait download(url, headers, outputPath);\n\t\tawait logFileDownload(source, outputPath);\n\n\t\treturn outputPath;\n\t}\n\n\treturn Promise.all(mappings.map(downloadSingleFile));\n}\n\ninterface SummaryData {\n\tallFiles: string[];\n\tdownloadedFiles: FileMapping[];\n\tref: string;\n\trepo: string;\n}\n\nasync function writeSummary({\n\tallFiles,\n\tdownloadedFiles,\n\tref,\n\trepo,\n}: SummaryData): Promise<void> {\n\tlet summaryWriter = summary\n\t\t.addHeading(\"ðŸ“¦ GitHub Downloader Action Summary\")\n\t\t.addBreak()\n\t\t.addTable([\n\t\t\t[{ data: \"Repository\" }, { data: repo }],\n\t\t\t[{ data: \"Branch\" }, { data: ref }],\n\t\t])\n\t\t.addBreak()\n\t\t.addHeading(\"Downloaded Files\", 2)\n\t\t.addTable([\n\t\t\t[\n\t\t\t\t{ data: \"Source Path\", header: true },\n\t\t\t\t{ data: \"Saved As\", header: true },\n\t\t\t],\n\t\t\t...downloadedFiles,\n\t\t])\n\t\t.addSeparator()\n\t\t.addHeading(\"Output Directory Files\", 2);\n\n\tif (allFiles) {\n\t\tfor (const file of allFiles) {\n\t\t\tsummaryWriter = summaryWriter.addRaw(`\\n- ${file}`);\n\t\t}\n\t} else {\n\t\tsummaryWriter = summaryWriter.addRaw(\n\t\t\t\"/n_No files found in output directory._\",\n\t\t);\n\t}\n\n\tawait summaryWriter.addBreak().write();\n}\n","import { run } from \"./main.js\";\n\nrun();\n"],"mappings":"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"}