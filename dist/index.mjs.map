{"version":3,"file":"index.mjs","names":["join","error: any"],"sources":["../src/utils.ts","../src/main.ts","../src/index.ts"],"sourcesContent":["import { createWriteStream, type Dirent } from \"fs\";\nimport { readdir } from \"fs/promises\";\nimport { get } from \"https\";\nimport { join } from \"path\";\n\nasync function download(\n\turl: string,\n\toptions: any,\n\toutput: string,\n): Promise<void> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst fileStream = createWriteStream(output);\n\t\tfileStream.on(\"error\", reject);\n\n\t\tconst req = get(url, options, (res) => {\n\t\t\tif (res.statusCode && res.statusCode >= 400) {\n\t\t\t\tres.resume();\n\t\t\t\treturn reject(\n\t\t\t\t\tnew Error(`Failed to download ${url} (status ${res.statusCode})`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tres.pipe(fileStream);\n\n\t\t\tfileStream.on(\"finish\", () => {\n\t\t\t\tfileStream.close((err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treq.on(\"error\", reject);\n\n\t\treq.setTimeout(15000, () => {\n\t\t\treq.destroy(new Error(`Request timed out for ${url}`));\n\t\t});\n\t});\n}\n\nasync function getFiles(directory: string): Promise<string[]> {\n\tconst dirents: Dirent[] = (await readdir(directory, {\n\t\trecursive: true,\n\t\twithFileTypes: true,\n\t})) as unknown as Dirent[];\n\treturn dirents\n\t\t.filter((dirent) => dirent.isFile())\n\t\t.map((dirent) => join(directory, dirent.name));\n}\n\nexport { download, getFiles };\n","import { mkdir } from \"node:fs/promises\";\nimport { dirname, join } from \"node:path\";\nimport { getInput, getMultilineInput, setFailed, summary } from \"@actions/core\";\nimport { download, getFiles } from \"./utils.js\";\n\nexport async function run(): Promise<void> {\n\ttry {\n\t\tconst pat = getInput(\"git-pat\");\n\t\tconst repo = getInput(\"repo\", { required: true });\n\t\tconst ref = getInput(\"ref\") || \"main\";\n\t\tconst outputDir = getInput(\"output-directory\");\n\t\tconst includes = getMultilineInput(\"includes\");\n\n\t\tif (!includes.length) {\n\t\t\tthrow new Error(\"No files specified in 'includes'.\");\n\t\t}\n\n\t\tconst options = pat ? { headers: { Authorization: `token ${pat}` } } : {};\n\n\t\tconst downloads = includes.map(async (include: string) => {\n\t\t\tconst [input, output] = include.split(\":\");\n\t\t\tif (!output) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Invalid 'includes' format: \"${include}\". Expected format is \"source:destination\".`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst outputLocation = outputDir ? join(outputDir, output) : output;\n\t\t\tconst url = `https://raw.githubusercontent.com/${repo}/${ref}/${input}`;\n\n\t\t\tawait mkdir(dirname(outputLocation), { recursive: true });\n\t\t\tawait download(url, options, outputLocation);\n\n\t\t\tconsole.log(`✅ Downloaded \"${input}\" → \"${outputLocation}\"`);\n\t\t\treturn outputLocation;\n\t\t});\n\n\t\tconst downloadedFiles = await Promise.all(downloads);\n\n\t\tconst allFiles = outputDir ? await getFiles(outputDir) : downloadedFiles;\n\n\t\tawait summary\n\t\t\t.addHeading(\"Download Summary\")\n\t\t\t.addTable([\n\t\t\t\t[\n\t\t\t\t\t{ data: \"Description\", header: true },\n\t\t\t\t\t{ data: \"Result\", header: true },\n\t\t\t\t],\n\t\t\t\t[\"Repo\", repo],\n\t\t\t\t[\"Ref\", ref],\n\t\t\t\t[\"Downloaded Files\", downloadedFiles.join(\"\\n\")],\n\t\t\t\t...(outputDir ? [[\"All Files in Output\", allFiles.join(\"\\n\")]] : []),\n\t\t\t])\n\t\t\t.write();\n\t} catch (error: any) {\n\t\tsetFailed(error instanceof Error ? error.message : String(error));\n\t}\n}\n","import { run } from \"./main.js\";\n\nrun();\n"],"mappings":";;;;;;;;;AAKA,eAAe,SACd,KACA,SACA,QACgB;AAChB,QAAO,IAAI,SAAS,SAAS,WAAW;EACvC,MAAM,aAAa,kBAAkB,OAAO;AAC5C,aAAW,GAAG,SAAS,OAAO;EAE9B,MAAM,MAAM,IAAI,KAAK,UAAU,QAAQ;AACtC,OAAI,IAAI,cAAc,IAAI,cAAc,KAAK;AAC5C,QAAI,QAAQ;AACZ,WAAO,uBACN,IAAI,MAAM,sBAAsB,IAAI,WAAW,IAAI,WAAW,GAAG,CACjE;;AAGF,OAAI,KAAK,WAAW;AAEpB,cAAW,GAAG,gBAAgB;AAC7B,eAAW,OAAO,QAAQ;AACzB,SAAI,IACH,QAAO,OAAO,IAAI;AAEnB,cAAS;MACR;KACD;IACD;AAEF,MAAI,GAAG,SAAS,OAAO;AAEvB,MAAI,WAAW,YAAa;AAC3B,OAAI,wBAAQ,IAAI,MAAM,yBAAyB,MAAM,CAAC;IACrD;GACD;;AAGH,eAAe,SAAS,WAAsC;AAK7D,SAJ2B,MAAM,QAAQ,WAAW;EACnD,WAAW;EACX,eAAe;EACf,CAAC,EAEA,QAAQ,WAAW,OAAO,QAAQ,CAAC,CACnC,KAAK,WAAWA,OAAK,WAAW,OAAO,KAAK,CAAC;;;;;AC5ChD,eAAsB,MAAqB;AAC1C,KAAI;EACH,MAAM,MAAM,SAAS,UAAU;EAC/B,MAAM,OAAO,SAAS,QAAQ,EAAE,UAAU,MAAM,CAAC;EACjD,MAAM,MAAM,SAAS,MAAM,IAAI;EAC/B,MAAM,YAAY,SAAS,mBAAmB;EAC9C,MAAM,WAAW,kBAAkB,WAAW;AAE9C,MAAI,CAAC,SAAS,OACb,OAAM,IAAI,MAAM,oCAAoC;EAGrD,MAAM,UAAU,MAAM,EAAE,SAAS,EAAE,eAAe,SAAS,OAAO,EAAE,GAAG,EAAE;EAEzE,MAAM,YAAY,SAAS,IAAI,OAAO,YAAoB;GACzD,MAAM,CAAC,OAAO,UAAU,QAAQ,MAAM,IAAI;AAC1C,OAAI,CAAC,OACJ,OAAM,IAAI,MACT,+BAA+B,QAAQ,6CACvC;GAEF,MAAM,iBAAiB,YAAY,KAAK,WAAW,OAAO,GAAG;GAC7D,MAAM,MAAM,qCAAqC,KAAK,GAAG,IAAI,GAAG;AAEhE,SAAM,MAAM,QAAQ,eAAe,EAAE,EAAE,WAAW,MAAM,CAAC;AACzD,SAAM,SAAS,KAAK,SAAS,eAAe;AAE5C,WAAQ,IAAI,iBAAiB,MAAM,OAAO,eAAe,GAAG;AAC5D,UAAO;IACN;EAEF,MAAM,kBAAkB,MAAM,QAAQ,IAAI,UAAU;EAEpD,MAAM,WAAW,YAAY,MAAM,SAAS,UAAU,GAAG;AAEzD,QAAM,QACJ,WAAW,mBAAmB,CAC9B,SAAS;GACT,CACC;IAAE,MAAM;IAAe,QAAQ;IAAM,EACrC;IAAE,MAAM;IAAU,QAAQ;IAAM,CAChC;GACD,CAAC,QAAQ,KAAK;GACd,CAAC,OAAO,IAAI;GACZ,CAAC,oBAAoB,gBAAgB,KAAK,KAAK,CAAC;GAChD,GAAI,YAAY,CAAC,CAAC,uBAAuB,SAAS,KAAK,KAAK,CAAC,CAAC,GAAG,EAAE;GACnE,CAAC,CACD,OAAO;UACDC,OAAY;AACpB,YAAU,iBAAiB,QAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;;;;;;ACpDnE,KAAK"}