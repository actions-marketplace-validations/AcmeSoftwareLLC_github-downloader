{"version":3,"file":"index.js","names":[],"sources":["../node_modules/@octokit/request-error/dist-src/index.js","../src/utils.ts","../src/main.ts","../src/index.ts"],"sourcesContent":["class RequestError extends Error {\n  name;\n  /**\n   * http status code\n   */\n  status;\n  /**\n   * Request options that lead to the error.\n   */\n  request;\n  /**\n   * Response object if a response was received\n   */\n  response;\n  constructor(message, statusCode, options) {\n    super(message, { cause: options.cause });\n    this.name = \"HttpError\";\n    this.status = Number.parseInt(statusCode);\n    if (Number.isNaN(this.status)) {\n      this.status = 0;\n    }\n    /* v8 ignore else -- @preserve -- Bug with vitest coverage where it sees an else branch that doesn't exist */\n    if (\"response\" in options) {\n      this.response = options.response;\n    }\n    const requestCopy = Object.assign({}, options.request);\n    if (options.request.headers.authorization) {\n      requestCopy.headers = Object.assign({}, options.request.headers, {\n        authorization: options.request.headers.authorization.replace(\n          /(?<! ) .*$/,\n          \" [REDACTED]\"\n        )\n      });\n    }\n    requestCopy.url = requestCopy.url.replace(/\\bclient_secret=\\w+/g, \"client_secret=[REDACTED]\").replace(/\\baccess_token=\\w+/g, \"access_token=[REDACTED]\");\n    this.request = requestCopy;\n  }\n}\nexport {\n  RequestError\n};\n","import type { Dirent } from \"node:fs\";\nimport { readdir, stat } from \"node:fs/promises\";\nimport { join } from \"node:path\";\n\nexport type FileMapping = [string, string];\n\nasync function getFiles(directory: string): Promise<string[]> {\n\tconst dirents: Dirent[] = (await readdir(directory, {\n\t\trecursive: true,\n\t\twithFileTypes: true,\n\t})) as unknown as Dirent[];\n\treturn dirents\n\t\t.filter((dirent) => dirent.isFile())\n\t\t.map((dirent) => join(directory, dirent.name));\n}\n\nasync function parseMappings(mappings: string[]): Promise<FileMapping[]> {\n\tconst mappingStr = mappings.join(\"\");\n\treturn Object.entries(JSON.parse(mappingStr));\n}\n\nasync function logFileDownload(\n\tinput: string,\n\toutputPath: string,\n): Promise<void> {\n\tconst { size } = await stat(outputPath);\n\tconst sizeStr =\n\t\tsize < 1024 ? `${size} bytes` : `${(size / 1024).toFixed(2)} KB`;\n\tconsole.log(\n\t\t`\\nðŸ“¥ File Downloaded!\\n` +\n\t\t\t`   â€¢ Source:      \\x1b[36m${input}\\x1b[0m\\n` +\n\t\t\t`   â€¢ Saved as:    \\x1b[32m${outputPath}\\x1b[0m\\n` +\n\t\t\t`   â€¢ Size:        \\x1b[33m${sizeStr}\\x1b[0m\\n` +\n\t\t\t`----------------------------------------`,\n\t);\n}\n\nexport { getFiles, logFileDownload, parseMappings };\n","import { mkdir, writeFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport {\n\tgetInput,\n\tgetMultilineInput,\n\tsetFailed,\n\tsetOutput,\n\tsummary,\n} from \"@actions/core\";\nimport { getOctokit } from \"@actions/github\";\nimport { RequestError } from \"@octokit/request-error\";\nimport {\n\ttype FileMapping,\n\tgetFiles,\n\tlogFileDownload,\n\tparseMappings,\n} from \"./utils.js\";\n\nexport async function run(): Promise<void> {\n\ttry {\n\t\tconst owner = getInput(\"owner\", { required: true });\n\t\tconst repo = getInput(\"repo\", { required: true });\n\t\tconst ref = getInput(\"ref\") || \"main\";\n\t\tconst token = getInput(\"token\", { required: true });\n\t\tconst outputDir = getInput(\"output-directory\") || \".\";\n\n\t\tconst mappings = await parseMappings(getMultilineInput(\"mappings\"));\n\t\tconst props = { owner, repo, ref, token, outputDir };\n\n\t\tconst downloadedFiles = await downloadMappedFiles(mappings, props);\n\t\tconst allFiles = await getFiles(outputDir);\n\n\t\tawait writeSummary({\n\t\t\tdownloadedFiles: mappings.map((mapping, index) => [\n\t\t\t\tmapping[0],\n\t\t\t\tdownloadedFiles[index],\n\t\t\t]),\n\t\t\trepo: `${owner}/${repo}`,\n\t\t\tref,\n\t\t\tallFiles,\n\t\t});\n\n\t\tsetOutput(\"files\", downloadedFiles);\n\t} catch (error) {\n\t\tsetFailed(error instanceof Error ? error.message : String(error));\n\t}\n}\n\ninterface DownloadProps {\n\towner: string;\n\trepo: string;\n\tref: string;\n\ttoken: string;\n\toutputDir: string;\n}\n\nasync function downloadMappedFiles(\n\tmappings: FileMapping[],\n\t{ owner, repo, ref, token, outputDir }: DownloadProps,\n): Promise<string[]> {\n\tconst octokit = getOctokit(token);\n\tawait mkdir(outputDir, { recursive: true });\n\n\tasync function downloadSingleFile(mapping: FileMapping): Promise<string> {\n\t\tconst [source, destination] = mapping;\n\t\tconst outputPath = join(outputDir, destination);\n\n\t\ttry {\n\t\t\tconst { data, status } = await octokit.rest.repos.getContent({\n\t\t\t\towner: owner,\n\t\t\t\trepo: repo,\n\t\t\t\tpath: source,\n\t\t\t\tref: ref,\n\t\t\t\tmediaType: { format: \"raw\" },\n\t\t\t});\n\t\t\tif (status !== 200 || typeof data !== \"string\") {\n\t\t\t\tthrow new Error(`Failed to download ${source} (status ${status})`);\n\t\t\t}\n\n\t\t\tawait writeFile(outputPath, data);\n\t\t\tawait logFileDownload(source, outputPath);\n\t\t} catch (error) {\n\t\t\tif (\n\t\t\t\terror instanceof RequestError ||\n\t\t\t\terror?.constructor?.name === \"RequestError\"\n\t\t\t) {\n\t\t\t\tconst err = error as RequestError;\n\t\t\t\tif (err.status === 401) {\n\t\t\t\t\tsetFailed(\n\t\t\t\t\t\t`Unauthorized access when trying to download ${source}. ` +\n\t\t\t\t\t\t\t`Please check if the provided token has contents access permissions.`,\n\t\t\t\t\t);\n\t\t\t\t} else if (err.status === 404) {\n\t\t\t\t\tsetFailed(\n\t\t\t\t\t\t`File not found: ${source}. ` +\n\t\t\t\t\t\t\t`Please check if there is a file at https://github.com/${owner}/${repo}/blob/${ref}/${source}`,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsetFailed(\n\t\t\t\t\t\t`Failed to download ${source}: ${err.message} (status: ${err.status})`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetFailed(\n\t\t\t\t\t`An unexpected error occurred while downloading ${source}: ${\n\t\t\t\t\t\terror instanceof Error ? error.message : String(error)\n\t\t\t\t\t}`,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn outputPath;\n\t}\n\n\treturn Promise.all(mappings.map(downloadSingleFile));\n}\n\ninterface SummaryData {\n\tallFiles: string[];\n\tdownloadedFiles: FileMapping[];\n\tref: string;\n\trepo: string;\n}\n\nasync function writeSummary({\n\tallFiles,\n\tdownloadedFiles,\n\tref,\n\trepo,\n}: SummaryData): Promise<void> {\n\tlet summaryWriter = summary\n\t\t.addHeading(\"ðŸ“¦ GitHub Downloader Action Summary\")\n\t\t.addBreak()\n\t\t.addTable([\n\t\t\t[{ data: \"Repository\" }, { data: repo }],\n\t\t\t[{ data: \"Branch\" }, { data: ref }],\n\t\t])\n\t\t.addBreak()\n\t\t.addHeading(\"Downloaded Files\", 2)\n\t\t.addTable([\n\t\t\t[\n\t\t\t\t{ data: \"Source Path\", header: true },\n\t\t\t\t{ data: \"Saved As\", header: true },\n\t\t\t],\n\t\t\t...downloadedFiles,\n\t\t])\n\t\t.addSeparator()\n\t\t.addHeading(\"Output Directory Files\", 2);\n\n\tif (allFiles) {\n\t\tfor (const file of allFiles) {\n\t\t\tsummaryWriter = summaryWriter.addRaw(`\\n- ${file}`);\n\t\t}\n\t} else {\n\t\tsummaryWriter = summaryWriter.addRaw(\n\t\t\t\"/n_No files found in output directory._\",\n\t\t);\n\t}\n\n\tawait summaryWriter.addBreak().write();\n}\n","import { run } from \"./main.js\";\n\nrun();\n"],"x_google_ignoreList":[0],"mappings":"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"}